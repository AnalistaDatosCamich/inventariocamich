
<!DOCTYPE html>
<html>
<head>
    <title>Inventario</title>
    <!--<link rel="stylesheet" href="../static/style.css"> -->
    <link rel="shortcut icon" href="../static/CamichLogo.ico">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <!-- CSS Responsive -->
    <!--<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">-->

    <!-- JS Responsive -->
    <!--<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script> -->

</head>
<body>
    <div id="container">
        <h1>Inventario de Artículos</h1>
        <h2>Modo administrador</h2>

        <!-- Formulario de login rápido -->
        <form method="POST" action="{{ url_for('login_admin') }}" style="display:flex; gap:10px; align-items:center;">
            <input type="text" name="username" placeholder="Usuario" required>
            <input type="password" name="password" placeholder="Contraseña" required>
            <button type="submit">Entrar</button>
        </form>

        <div class="table-container" >
        <table id="items-table">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descripción</th>
                    <th>Usuario</th>
                    <th>Departamento</th>
                    <th>Foto</th>
                    <th>Descripción detallada</th>
                </tr>
                <tr>
                    <th><input type="text" placeholder="Buscar código"></th>
                    <th><input type="text" placeholder="Buscar descripción"></th>
                    <th><input type="text" placeholder="Buscar usuario"></th>
                    <th><input type="text" placeholder="Buscar departamento"></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}           
                <tr>
                    <td>{{ item[1] }}</td>
                    <td>{{ item[2] }}</td>
                    <td>{{ item[4] }}</td>
                    <td>{{ item[5] }}</td>
                    <td>
                        <img src="{{ url_for('static', filename='images/' + (item[7] or 'camich.png')) }}" width="50">
                    </td>
                    <td>
                        <a href="{{ url_for('item_detail', codigo=item[1]) }}">Ver más</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</body>

<script>
$(document).ready(function () {
    var table = $('#items-table').DataTable({
        orderCellsTop: true,
        scrollX: true,
        autoWidth: false,
        language: {
            "search": "Buscar:",
            "lengthMenu": "Mostrar _MENU_ registros por página",
            "zeroRecords": "No se encontraron resultados",
            "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
            "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
            "infoFiltered": "(filtrado de un total de _MAX_ registros)",
            "paginate": {
                "first": "Primero",
                "last": "Último",
                "next": "Siguiente",
                "previous": "Anterior"
            }
        }
    });

    // Fix para el desfase del header
    $(window).on('resize', function() {
        setTimeout(function() {
            table.columns.adjust().draw();
        }, 100);
    });
    
    // Fix inicial
    setTimeout(function() {
        table.columns.adjust().draw();
    }, 200);
    
    // Aplicar búsqueda por columnas - método alternativo
    $('#items-table thead tr:eq(1) th').each(function (index) {
        var $input = $(this).find('input');
        if ($input.length > 0) {
            console.log('Configurando input para columna:', index);
            $input.on('keyup change', function () {
                var val = $.fn.dataTable.util.escapeRegex($(this).val());
                table.column(index).search(val ? val : '', true, false).draw();
            });
        }
    });
});

</script>
</html>
